RewriteEngine On

# Security Headers
Header always set X-Content-Type-Options nosniff
Header always set X-Frame-Options DENY
Header always set X-XSS-Protection "1; mode=block"

# Prevent access to sensitive files
<Files "composer.json">
    Order allow,deny
    Deny from all
</Files>

<Files "composer.lock">
    Order allow,deny
    Deny from all
</Files>

<Files "*.env">
    Order allow,deny
    Deny from all
</Files>

<Files "config.php">
    Order allow,deny
    Deny from all
</Files>

# Block access to config and bootstrap directories via URL
RewriteRule ^config/ - [F,L]
RewriteRule ^bootstrap/ - [F,L]
RewriteRule ^app/ - [F,L]
RewriteRule ^vendor/ - [F,L]
RewriteRule ^storage/ - [F,L]

# Disable directory browsing
Options -Indexes

# Allow existing files and directories to be accessed directly
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Route everything through public/index.php
RewriteRule ^(.*)$ public/index.php [QSA,L]